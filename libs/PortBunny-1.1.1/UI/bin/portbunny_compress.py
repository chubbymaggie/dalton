#!/usr/bin/python

# Takes portbunny port-results generated by
# portbunny_logger.py and compresses it, which
# means that:
#
# (1) If a port was reported as open, discard all other reports regarding
# this port.
# (2) If a port was reported as closed, discard all filtered entries.
# (3) Remove either info about filtered/closed ports, depending on which
# ones are the majority.

import sys

CLOSED = '0'
FILTERED = '1'
OPEN = '2'

filename = sys.argv[1]

port_dict = {}


f = open(filename, 'r')

for line in f:
    
    elem = line.split()
    
    port = elem[0]
    state = elem[1]
       
    if state == OPEN:
        port_dict[port] = state
    elif state == CLOSED:
        
        if port_dict.has_key(port):
            if port_dict[port] != OPEN:
                port_dict[port] = state
        else:
            port_dict[port] = state
            
    elif state == FILTERED:
        if not port_dict.has_key(port):
            port_dict[port] = state


for p in port_dict.keys():
    print p + " " + port_dict[p]
